<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sweet Dreams Cake Shop ðŸŽ‚ - Vajreshwati, Virar</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        /* Custom Styles for Sweet Dreams Cake Shop */
        :root {
            --primary-pink: #ec4899;
            --secondary-pink: #f472b6;
            --accent-purple: #a855f7;
        }
        
        .bg-pink-gradient {
            background: linear-gradient(135deg, var(--primary-pink) 0%, var(--accent-purple) 100%);
        }
        
        .text-rupee {
            font-family: Arial, sans-serif;
        }
        
        .card-shadow {
            box-shadow: 0 10px 25px rgba(236, 72, 153, 0.1);
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            transition: all 0.3s ease;
            box-shadow: 0 15px 35px rgba(236, 72, 153, 0.15);
        }
        
        .border-pink-glow {
            border: 2px solid transparent;
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(135deg, var(--primary-pink), var(--accent-purple)) border-box;
        }
        
        .sidebar-item.active {
            background-color: rgba(236, 72, 153, 0.1);
            border-left: 4px solid var(--primary-pink);
        }
        
        .floating-btn {
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.3);
        }
        
        .location-badge {
            background: linear-gradient(135deg, #f59e0b, #fbbf24);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(245, 158, 11, 0); }
            100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); }
        }
        
        .order-status {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .status-pending { background-color: #fef3c7; color: #92400e; }
        .status-processing { background-color: #dbeafe; color: #1e40af; }
        .status-shipped { background-color: #f0f9ff; color: #0c4a6e; }
        .status-delivered { background-color: #d1fae5; color: #065f46; }
        .status-cancelled { background-color: #fee2e2; color: #991b1b; }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--secondary-pink);
            border-radius: 10px;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-pink);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .mobile-hide {
                display: none;
            }
            
            .mobile-stack {
                flex-direction: column;
            }
            
            .mobile-full {
                width: 100% !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 rounded-full bg-pink-gradient flex items-center justify-center">
                    <i class="fas fa-birthday-cake text-white text-xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-800">Sweet Dreams Cake Shop</h1>
                    <div class="flex items-center text-sm">
                        <i class="fas fa-map-marker-alt text-amber-500 mr-1"></i>
                        <span class="text-gray-600">Vajreshwati, Virar West</span>
                    </div>
                </div>
            </div>
            
            <div class="hidden md:flex items-center space-x-8">
                <a href="#home" class="nav-link text-gray-700 hover:text-pink-500 font-medium">Home</a>
                <a href="#shop" class="nav-link text-gray-700 hover:text-pink-500 font-medium">Shop</a>
                <a href="#categories" class="nav-link text-gray-700 hover:text-pink-500 font-medium">Categories</a>
                <a href="#contact" class="nav-link text-gray-700 hover:text-pink-500 font-medium">Contact</a>
            </div>
            
            <div class="flex items-center space-x-4">
                <!-- Location Badge -->
                <div class="hidden md:flex items-center location-badge text-white px-3 py-1 rounded-full">
                    <i class="fas fa-map-marker-alt mr-2"></i>
                    <span class="text-sm font-medium">Free Delivery in Virar</span>
                </div>
                
                <!-- Cart Button -->
                <button id="cartBtn" class="relative p-2 hover:bg-pink-50 rounded-full">
                    <i class="fas fa-shopping-cart text-gray-700 text-xl"></i>
                    <span id="cartCount" class="absolute -top-1 -right-1 bg-pink-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                </button>
                
                <!-- User Menu -->
                <div class="relative">
                    <button id="userMenuBtn" class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100">
                        <div class="w-8 h-8 rounded-full bg-pink-gradient flex items-center justify-center text-white font-semibold">
                            <i class="fas fa-user"></i>
                        </div>
                        <span class="hidden md:inline text-gray-700 font-medium" id="userName">Account</span>
                        <i class="fas fa-chevron-down text-gray-500"></i>
                    </button>
                    
                    <div id="userMenu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-2 z-50 border border-gray-200">
                        <a href="#profile" class="user-menu-item block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600">
                            <i class="fas fa-user-circle mr-2"></i> My Profile
                        </a>
                        <a href="#orders" class="user-menu-item block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600">
                            <i class="fas fa-shopping-bag mr-2"></i> My Orders
                        </a>
                        <a href="#wishlist" class="user-menu-item block px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600">
                            <i class="fas fa-heart mr-2"></i> Wishlist
                        </a>
                        <hr class="my-2">
                        <button id="adminBtn" class="admin-only hidden block w-full text-left px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600">
                            <i class="fas fa-tachometer-alt mr-2"></i> Admin Panel
                        </button>
                        <button id="logoutBtn" class="block w-full text-left px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600">
                            <i class="fas fa-sign-out-alt mr-2"></i> Logout
                        </button>
                        <button id="loginBtn" class="auth-hidden block w-full text-left px-4 py-2 text-gray-700 hover:bg-pink-50 hover:text-pink-600">
                            <i class="fas fa-sign-in-alt mr-2"></i> Login / Register
                        </button>
                    </div>
                </div>
                
                <!-- Mobile menu button -->
                <button id="mobileMenuBtn" class="md:hidden p-2">
                    <i class="fas fa-bars text-gray-700 text-xl"></i>
                </button>
            </div>
        </div>
        
        <!-- Mobile menu -->
        <div id="mobileMenu" class="hidden md:hidden bg-white border-t px-4 py-3">
            <div class="flex flex-col space-y-3">
                <a href="#home" class="nav-link text-gray-700 hover:text-pink-500 font-medium py-2">Home</a>
                <a href="#shop" class="nav-link text-gray-700 hover:text-pink-500 font-medium py-2">Shop</a>
                <a href="#categories" class="nav-link text-gray-700 hover:text-pink-500 font-medium py-2">Categories</a>
                <a href="#contact" class="nav-link text-gray-700 hover:text-pink-500 font-medium py-2">Contact</a>
                <div class="flex items-center location-badge text-white px-3 py-2 rounded-full justify-center">
                    <i class="fas fa-map-marker-alt mr-2"></i>
                    <span class="text-sm font-medium">Free Delivery in Virar</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-6">
        <!-- Customer View -->
        <div id="customerView">
            <!-- Hero Section -->
            <section id="home" class="mb-12">
                <div class="rounded-2xl bg-pink-gradient p-8 md:p-12 text-white overflow-hidden relative">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-10 rounded-full -translate-y-32 translate-x-32"></div>
                    <div class="absolute bottom-0 left-0 w-48 h-48 bg-white opacity-10 rounded-full translate-y-24 -translate-x-24"></div>
                    
                    <div class="relative max-w-2xl">
                        <div class="inline-flex items-center bg-white bg-opacity-20 text-white px-4 py-2 rounded-full text-sm mb-6">
                            <i class="fas fa-star mr-2"></i>
                            <span>Rated #1 Cake Shop in Vajreshwati</span>
                        </div>
                        <h2 class="text-4xl md:text-5xl font-bold mb-4">Fresh Cakes Delivered to Your Doorstep in Virar</h2>
                        <p class="text-xl mb-8 opacity-90">Celebrate every occasion with our handcrafted cakes made with love and finest ingredients</p>
                        <div class="flex flex-wrap gap-4">
                            <button class="bg-white text-pink-600 font-bold px-8 py-3 rounded-full hover:bg-gray-100 transition duration-300 flex items-center">
                                Order Now <i class="fas fa-birthday-cake ml-2"></i>
                            </button>
                            <button class="border-2 border-white text-white font-bold px-8 py-3 rounded-full hover:bg-white hover:text-pink-600 transition duration-300 flex items-center">
                                <i class="fas fa-phone-alt mr-2"></i> Call: 98765 43210
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Categories Section -->
            <section id="categories" class="mb-12">
                <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Shop By Category</h2>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
                    <button class="category-btn active-category bg-pink-100 border-2 border-pink-300 rounded-xl p-4 text-center hover:bg-pink-200 transition duration-300" data-category="all">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-pink-gradient flex items-center justify-center">
                            <i class="fas fa-star text-white text-xl"></i>
                        </div>
                        <span class="font-bold text-gray-800 text-sm">All Cakes</span>
                    </button>
                    <button class="category-btn bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4 text-center hover:bg-yellow-100 transition duration-300" data-category="birthday">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-gradient-to-r from-yellow-400 to-orange-400 flex items-center justify-center">
                            <i class="fas fa-birthday-cake text-white text-xl"></i>
                        </div>
                        <span class="font-bold text-gray-800 text-sm">Birthday</span>
                    </button>
                    <button class="category-btn bg-purple-50 border-2 border-purple-200 rounded-xl p-4 text-center hover:bg-purple-100 transition duration-300" data-category="wedding">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-gradient-to-r from-purple-400 to-indigo-400 flex items-center justify-center">
                            <i class="fas fa-ring text-white text-xl"></i>
                        </div>
                        <span class="font-bold text-gray-800 text-sm">Wedding</span>
                    </button>
                    <button class="category-btn bg-blue-50 border-2 border-blue-200 rounded-xl p-4 text-center hover:bg-blue-100 transition duration-300" data-category="cupcakes">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-gradient-to-r from-blue-400 to-cyan-400 flex items-center justify-center">
                            <i class="fas fa-cupcake text-white text-xl"></i>
                        </div>
                        <span class="font-bold text-gray-800 text-sm">Cupcakes</span>
                    </button>
                    <button class="category-btn bg-green-50 border-2 border-green-200 rounded-xl p-4 text-center hover:bg-green-100 transition duration-300" data-category="desserts">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-gradient-to-r from-green-400 to-emerald-400 flex items-center justify-center">
                            <i class="fas fa-ice-cream text-white text-xl"></i>
                        </div>
                        <span class="font-bold text-gray-800 text-sm">Desserts</span>
                    </button>
                </div>
            </section>

            <!-- Product Grid -->
            <section id="shop" class="mb-16">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800">Our Delicious Cakes</h2>
                        <p class="text-gray-600">Freshly baked in Vajreshwati, Virar</p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <div class="relative">
                            <input type="text" id="productSearch" placeholder="Search cakes..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent w-full md:w-auto">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        <select id="sortProducts" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                            <option value="name">Sort by Name</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="popular">Most Popular</option>
                        </select>
                    </div>
                </div>
                
                <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Products will be loaded dynamically -->
                </div>
                
                <div class="text-center mt-12">
                    <button id="loadMore" class="bg-pink-gradient text-white font-bold px-8 py-3 rounded-full hover:opacity-90 transition duration-300 shadow-lg">
                        Load More Cakes <i class="fas fa-chevron-down ml-2"></i>
                    </button>
                </div>
            </section>
        </div>

        <!-- Admin Dashboard (Hidden by default) -->
        <div id="adminView" class="hidden">
            <div class="flex flex-col md:flex-row gap-6">
                <!-- Sidebar -->
                <div class="md:w-1/5 bg-white rounded-xl shadow p-4 h-fit">
                    <div class="flex items-center mb-8">
                        <div class="w-10 h-10 rounded-full bg-pink-gradient flex items-center justify-center mr-3">
                            <i class="fas fa-crown text-white"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-gray-800">Admin Panel</h3>
                            <p class="text-sm text-gray-500">Sweet Dreams Virar</p>
                        </div>
                    </div>
                    
                    <nav class="space-y-2">
                        <button class="sidebar-btn active w-full text-left px-4 py-3 rounded-lg sidebar-item" data-section="dashboard">
                            <i class="fas fa-tachometer-alt mr-3"></i> Dashboard
                        </button>
                        <button class="sidebar-btn w-full text-left px-4 py-3 rounded-lg sidebar-item" data-section="orders">
                            <i class="fas fa-shopping-bag mr-3"></i> Orders
                            <span id="pendingOrdersBadge" class="ml-auto bg-red-500 text-white text-xs rounded-full px-2 py-1">0</span>
                        </button>
                        <button class="sidebar-btn w-full text-left px-4 py-3 rounded-lg sidebar-item" data-section="products">
                            <i class="fas fa-birthday-cake mr-3"></i> Products
                        </button>
                        <button class="sidebar-btn w-full text-left px-4 py-3 rounded-lg sidebar-item" data-section="customers">
                            <i class="fas fa-users mr-3"></i> Customers
                        </button>
                        <button class="sidebar-btn w-full text-left px-4 py-3 rounded-lg sidebar-item" data-section="analytics">
                            <i class="fas fa-chart-line mr-3"></i> Analytics
                        </button>
                        <hr class="my-4">
                        <button id="backToStore" class="w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 flex items-center">
                            <i class="fas fa-store mr-3"></i> Back to Store
                        </button>
                    </nav>
                </div>
                
                <!-- Main Content -->
                <div class="md:w-4/5">
                    <!-- Dashboard Section -->
                    <div id="dashboardSection" class="admin-section">
                        <div class="bg-white rounded-xl shadow p-6 mb-6">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">Dashboard Overview</h2>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                                <div class="bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-100 rounded-xl p-5">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-gray-500">Total Revenue</p>
                                            <h3 class="text-2xl font-bold text-gray-800 mt-2"><span class="text-rupee">â‚¹</span>1,24,580</h3>
                                        </div>
                                        <div class="bg-blue-100 p-3 rounded-lg">
                                            <i class="fas fa-rupee-sign text-blue-600 text-xl"></i>
                                        </div>
                                    </div>
                                    <p class="text-green-600 text-sm mt-3"><i class="fas fa-arrow-up mr-1"></i> 12.5% from last month</p>
                                </div>
                                <div class="bg-gradient-to-r from-pink-50 to-rose-50 border border-pink-100 rounded-xl p-5">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-gray-500">Total Orders</p>
                                            <h3 class="text-2xl font-bold text-gray-800 mt-2">324</h3>
                                        </div>
                                        <div class="bg-pink-100 p-3 rounded-lg">
                                            <i class="fas fa-shopping-bag text-pink-600 text-xl"></i>
                                        </div>
                                    </div>
                                    <p class="text-green-600 text-sm mt-3"><i class="fas fa-arrow-up mr-1"></i> 8.2% from last month</p>
                                </div>
                                <div class="bg-gradient-to-r from-purple-50 to-violet-50 border border-purple-100 rounded-xl p-5">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-gray-500">Total Customers</p>
                                            <h3 class="text-2xl font-bold text-gray-800 mt-2">1,248</h3>
                                        </div>
                                        <div class="bg-purple-100 p-3 rounded-lg">
                                            <i class="fas fa-users text-purple-600 text-xl"></i>
                                        </div>
                                    </div>
                                    <p class="text-green-600 text-sm mt-3"><i class="fas fa-arrow-up mr-1"></i> 5.7% from last month</p>
                                </div>
                                <div class="bg-gradient-to-r from-yellow-50 to-amber-50 border border-yellow-100 rounded-xl p-5">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-gray-500">Pending Orders</p>
                                            <h3 class="text-2xl font-bold text-gray-800 mt-2">18</h3>
                                        </div>
                                        <div class="bg-yellow-100 p-3 rounded-lg">
                                            <i class="fas fa-clock text-yellow-600 text-xl"></i>
                                        </div>
                                    </div>
                                    <p class="text-red-600 text-sm mt-3"><i class="fas fa-arrow-down mr-1"></i> 3 from yesterday</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-lg font-bold text-gray-800 mb-4">Recent Orders</h3>
                                    <div class="bg-gray-50 rounded-lg p-4 custom-scrollbar" style="max-height: 400px; overflow-y: auto;">
                                        <div id="recentOrdersList" class="space-y-4">
                                            <!-- Recent orders will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-gray-800 mb-4">Top Products</h3>
                                    <div class="bg-gray-50 rounded-lg p-4 custom-scrollbar" style="max-height: 400px; overflow-y: auto;">
                                        <div id="topProductsList" class="space-y-4">
                                            <!-- Top products will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Orders Management Section -->
                    <div id="ordersSection" class="admin-section hidden">
                        <div class="bg-white rounded-xl shadow p-6">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                                <h2 class="text-2xl font-bold text-gray-800">Order Management</h2>
                                <div class="flex flex-wrap gap-3">
                                    <div class="relative">
                                        <input type="text" id="orderSearch" placeholder="Search orders..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                    </div>
                                    <select id="orderFilter" class="border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                                        <option value="all">All Orders</option>
                                        <option value="pending">Pending</option>
                                        <option value="processing">Processing</option>
                                        <option value="shipped">Shipped</option>
                                        <option value="delivered">Delivered</option>
                                        <option value="cancelled">Cancelled</option>
                                    </select>
                                    <button id="exportOrdersBtn" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium px-4 py-2 rounded-lg transition duration-300 flex items-center">
                                        <i class="fas fa-file-export mr-2"></i> Export
                                    </button>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="bg-gray-100">
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Order ID</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Customer</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Date</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Total</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ordersTableBody">
                                        <!-- Orders will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Products Management Section -->
                    <div id="productsSection" class="admin-section hidden">
                        <div class="bg-white rounded-xl shadow p-6">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                                <h2 class="text-2xl font-bold text-gray-800">Product Management</h2>
                                <button id="addProductBtn" class="bg-pink-gradient text-white font-bold px-5 py-2.5 rounded-lg hover:opacity-90 transition duration-300 flex items-center">
                                    <i class="fas fa-plus mr-2"></i> Add Product
                                </button>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-100 rounded-xl p-5">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-gray-500">Total Products</p>
                                            <h3 class="text-2xl font-bold text-gray-800 mt-2" id="totalProducts">0</h3>
                                        </div>
                                        <div class="bg-green-100 p-3 rounded-lg">
                                            <i class="fas fa-birthday-cake text-green-600 text-xl"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-100 rounded-xl p-5">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-gray-500">Out of Stock</p>
                                            <h3 class="text-2xl font-bold text-gray-800 mt-2" id="outOfStock">0</h3>
                                        </div>
                                        <div class="bg-amber-100 p-3 rounded-lg">
                                            <i class="fas fa-exclamation-triangle text-amber-600 text-xl"></i>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-gradient-to-r from-red-50 to-rose-50 border border-red-100 rounded-xl p-5">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-gray-500">Low Stock (< 10)</p>
                                            <h3 class="text-2xl font-bold text-gray-800 mt-2" id="lowStock">0</h3>
                                        </div>
                                        <div class="bg-red-100 p-3 rounded-lg">
                                            <i class="fas fa-box-open text-red-600 text-xl"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="bg-gray-100">
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Product</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Category</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Price</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Stock</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productsTableBody">
                                        <!-- Products will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Customers Management Section -->
                    <div id="customersSection" class="admin-section hidden">
                        <div class="bg-white rounded-xl shadow p-6">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                                <h2 class="text-2xl font-bold text-gray-800">Customer Management</h2>
                                <div class="relative">
                                    <input type="text" id="customerSearch" placeholder="Search customers..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="bg-gray-100">
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Customer</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Email</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Orders</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Total Spent</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customersTableBody">
                                        <!-- Customers will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Analytics Section -->
                    <div id="analyticsSection" class="admin-section hidden">
                        <div class="bg-white rounded-xl shadow p-6">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">Analytics Dashboard</h2>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                                <div class="bg-gray-50 rounded-xl p-4">
                                    <h3 class="text-lg font-bold text-gray-800 mb-4">Revenue Overview (â‚¹)</h3>
                                    <canvas id="revenueChart"></canvas>
                                </div>
                                <div class="bg-gray-50 rounded-xl p-4">
                                    <h3 class="text-lg font-bold text-gray-800 mb-4">Top Categories</h3>
                                    <canvas id="categoryChart"></canvas>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-xl p-4">
                                <h3 class="text-lg font-bold text-gray-800 mb-4">Order Trends</h3>
                                <canvas id="ordersChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals Section -->
    
    <!-- Shopping Cart Modal -->
    <div id="cartModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 z-50 flex justify-end">
        <div class="bg-white w-full md:w-1/3 h-full overflow-y-auto custom-scrollbar">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Your Cart</h2>
                    <button id="closeCartBtn" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <div id="cartItems" class="mb-6">
                    <div id="emptyCart" class="text-center py-12">
                        <i class="fas fa-shopping-cart text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">Your cart is empty</p>
                        <p class="text-gray-400">Add some delicious cakes!</p>
                    </div>
                </div>
                
                <div class="border-t pt-4">
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-600">Subtotal</span>
                        <span id="cartSubtotal" class="font-bold"><span class="text-rupee">â‚¹</span>0</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-600">Delivery (Virar)</span>
                        <span id="cartShipping" class="font-bold"><span class="text-rupee">â‚¹</span>0</span>
                    </div>
                    <div class="flex justify-between mb-4 text-lg">
                        <span class="font-bold">Total</span>
                        <span id="cartTotal" class="font-bold text-pink-600"><span class="text-rupee">â‚¹</span>0</span>
                    </div>
                    
                    <button id="checkoutBtn" class="w-full bg-pink-gradient text-white font-bold py-3 rounded-lg hover:opacity-90 transition duration-300 mb-4 shadow-lg">
                        Proceed to Checkout <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                    
                    <button id="continueShopping" class="w-full border border-gray-300 text-gray-700 font-medium py-3 rounded-lg hover:bg-gray-50 transition duration-300">
                        Continue Shopping
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div id="checkoutModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto custom-scrollbar">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Checkout</h2>
                    <button id="closeCheckoutBtn" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <form id="checkoutForm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Delivery Information</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-gray-700 mb-2">Full Name</label>
                                    <input type="text" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">Phone Number</label>
                                    <input type="tel" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent" placeholder="98765 43210">
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">Address in Virar</label>
                                    <textarea rows="3" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent" placeholder="Building name, Street, Area, Virar West"></textarea>
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">Delivery Date & Time</label>
                                    <select class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                                        <option>Today - ASAP</option>
                                        <option>Tomorrow Morning</option>
                                        <option>Tomorrow Evening</option>
                                        <option>Select Specific Date</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Order Summary</h3>
                            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                <div id="checkoutItems">
                                    <!-- Order items will be loaded here -->
                                </div>
                                <div class="border-t pt-3 mt-3">
                                    <div class="flex justify-between mb-2">
                                        <span class="text-gray-600">Subtotal</span>
                                        <span id="checkoutSubtotal" class="font-bold"><span class="text-rupee">â‚¹</span>0</span>
                                    </div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-gray-600">Delivery (Virar)</span>
                                        <span id="checkoutShipping" class="font-bold"><span class="text-rupee">â‚¹</span>0</span>
                                    </div>
                                    <div class="flex justify-between text-lg font-bold border-t pt-2">
                                        <span>Total</span>
                                        <span id="checkoutTotal" class="text-pink-600"><span class="text-rupee">â‚¹</span>0</span>
                                    </div>
                                </div>
                            </div>
                            
                            <h3 class="text-lg font-bold text-gray-800 mb-4">Payment Method</h3>
                            <div class="space-y-3 mb-6">
                                <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="payment" value="cod" checked class="mr-3">
                                    <div>
                                        <div class="font-medium">Cash on Delivery</div>
                                        <div class="text-sm text-gray-500">Pay when you receive your order</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="payment" value="upi" class="mr-3">
                                    <div>
                                        <div class="font-medium">UPI Payment</div>
                                        <div class="text-sm text-gray-500">Google Pay, PhonePe, Paytm</div>
                                    </div>
                                </label>
                            </div>
                            
                            <button type="submit" class="w-full bg-pink-gradient text-white font-bold py-3 rounded-lg hover:opacity-90 transition duration-300 shadow-lg">
                                Place Order <i class="fas fa-check ml-2"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="authModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800" id="authTitle">Login</h2>
                    <button id="closeAuthBtn" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <div class="flex border-b mb-6">
                    <button id="loginTab" class="auth-tab active flex-1 py-3 text-center font-medium text-pink-600 border-b-2 border-pink-600">Login</button>
                    <button id="registerTab" class="auth-tab flex-1 py-3 text-center font-medium text-gray-500">Register</button>
                </div>
                
                <form id="loginForm">
                    <div class="space-y-4 mb-6">
                        <div>
                            <label class="block text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="loginEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent" placeholder="customer@example.com">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Password</label>
                            <input type="password" id="loginPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full bg-pink-gradient text-white font-bold py-3 rounded-lg hover:opacity-90 transition duration-300 mb-4">
                        Login <i class="fas fa-sign-in-alt ml-2"></i>
                    </button>
                    
                    <div class="text-center mb-4">
                        <span class="text-gray-500">or login with</span>
                    </div>
                    
                    <button type="button" id="googleLoginBtn" class="w-full border border-gray-300 text-gray-700 font-medium py-3 rounded-lg hover:bg-gray-50 transition duration-300 mb-6 flex items-center justify-center">
                        <i class="fab fa-google mr-2 text-red-500"></i> Google
                    </button>
                    
                    <div class="text-center">
                        <a href="#" class="text-pink-600 hover:text-pink-800 text-sm">Forgot your password?</a>
                    </div>
                </form>
                
                <form id="registerForm" class="hidden">
                    <div class="space-y-4 mb-6">
                        <div>
                            <label class="block text-gray-700 mb-2">Full Name</label>
                            <input type="text" id="registerName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent" placeholder="John Doe">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" id="registerPhone" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent" placeholder="98765 43210">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="registerEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent" placeholder="customer@example.com">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Password</label>
                            <input type="password" id="registerPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full bg-pink-gradient text-white font-bold py-3 rounded-lg hover:opacity-90 transition duration-300">
                        Create Account <i class="fas fa-user-plus ml-2"></i>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div id="productModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto custom-scrollbar">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800" id="productModalTitle">Add New Product</h2>
                    <button id="closeProductModalBtn" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <form id="productForm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-gray-700 mb-2">Product Name</label>
                            <input type="text" id="productName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Category</label>
                            <select id="productCategory" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                                <option value="birthday">Birthday Cakes</option>
                                <option value="wedding">Wedding Cakes</option>
                                <option value="cupcakes">Cupcakes</option>
                                <option value="desserts">Desserts</option>
                                <option value="custom">Custom Cakes</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Price (â‚¹)</label>
                            <input type="number" id="productPrice" min="0" step="1" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Stock Quantity</label>
                            <input type="number" id="productStock" min="0" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 mb-2">Description</label>
                            <textarea id="productDescription" rows="4" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent"></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-gray-700 mb-2">Image URL</label>
                            <input type="text" id="productImage" placeholder="https://example.com/image.jpg" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-300 focus:border-transparent">
                            <p class="text-sm text-gray-500 mt-2">Leave empty to use a default cake image</p>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-4">
                        <button type="button" id="cancelProductBtn" class="border border-gray-300 text-gray-700 font-medium px-6 py-3 rounded-lg hover:bg-gray-50 transition duration-300">
                            Cancel
                        </button>
                        <button type="submit" id="saveProductBtn" class="bg-pink-gradient text-white font-bold px-6 py-3 rounded-lg hover:opacity-90 transition duration-300">
                            Save Product
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 bg-white bg-opacity-80 z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-gray-700 font-medium">Loading...</p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white mt-16">
        <div class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <div class="w-10 h-10 rounded-full bg-pink-gradient flex items-center justify-center">
                            <i class="fas fa-birthday-cake text-white text-xl"></i>
                        </div>
                        <h2 class="text-xl font-bold">Sweet Dreams Cake Shop</h2>
                    </div>
                    <p class="text-gray-400">Delicious cakes made with love in Vajreshwati, Virar since 2018.</p>
                    <div class="mt-4 flex items-center">
                        <i class="fas fa-star text-yellow-400 mr-1"></i>
                        <i class="fas fa-star text-yellow-400 mr-1"></i>
                        <i class="fas fa-star text-yellow-400 mr-1"></i>
                        <i class="fas fa-star text-yellow-400 mr-1"></i>
                        <i class="fas fa-star text-yellow-400 mr-2"></i>
                        <span class="text-gray-300">4.8/5 (1248 reviews)</span>
                    </div>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Quick Links</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="#home" class="hover:text-white transition duration-300">Home</a></li>
                        <li><a href="#shop" class="hover:text-white transition duration-300">Shop Cakes</a></li>
                        <li><a href="#categories" class="hover:text-white transition duration-300">Categories</a></li>
                        <li><a href="#contact" class="hover:text-white transition duration-300">Contact Us</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Contact Info</h3>
                    <ul class="space-y-3 text-gray-400">
                        <li class="flex items-start">
                            <i class="fas fa-map-marker-alt mr-3 mt-1 text-amber-500"></i>
                            <span>Shop No. 5, Vajreshwati Complex,<br>Virar West, Maharashtra 401303</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-phone mr-3 text-green-500"></i>
                            <span>98765 43210</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-envelope mr-3 text-blue-500"></i>
                            <span>orders@sweetdreamsvirar.com</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-bold mb-4">Business Hours</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li class="flex justify-between">
                            <span>Monday - Friday:</span>
                            <span>8 AM - 10 PM</span>
                        </li>
                        <li class="flex justify-between">
                            <span>Saturday - Sunday:</span>
                            <span>7 AM - 11 PM</span>
                        </li>
                        <li class="mt-4 pt-4 border-t border-gray-800">
                            <p class="text-sm">Free delivery in Virar area</p>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                <p>&copy; 2024 Sweet Dreams Cake Shop, Vajreshwati Virar. All rights reserved.</p>
                <p class="text-sm mt-2">Made with <i class="fas fa-heart text-pink-500"></i> for Virar</p>
            </div>
        </div>
    </footer>

    <!-- Main JavaScript -->
    <script>
        // Supabase Configuration - REPLACE WITH YOUR OWN CREDENTIALS
        const SUPABASE_URL = 'https://wgappfwmkgkrerroxqnf.supabase.co'; // Replace with your Supabase URL
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndnYXBwZndta2drcmVycm94cW5mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2NTcwMDQsImV4cCI6MjA4NDIzMzAwNH0.L9O1gkr9bPVNxvLX7JXX8qH9_7Ow6YOMa9-87dFh1Ag'; // Replace with your Supabase anon key
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Application State
        let currentUser = null;
        let currentView = 'customer';
        let editingProductId = null;
        let products = [];
        let cart = JSON.parse(localStorage.getItem('sweetdreams_cart')) || [];
        let productsLoaded = 0;

        // DOM Elements
        const elements = {
            // Views
            customerView: document.getElementById('customerView'),
            adminView: document.getElementById('adminView'),
            
            // Auth elements
            authModal: document.getElementById('authModal'),
            loginTab: document.getElementById('loginTab'),
            registerTab: document.getElementById('registerTab'),
            loginForm: document.getElementById('loginForm'),
            registerForm: document.getElementById('registerForm'),
            authTitle: document.getElementById('authTitle'),
            closeAuthBtn: document.getElementById('closeAuthBtn'),
            googleLoginBtn: document.getElementById('googleLoginBtn'),
            
            // User menu
            userMenuBtn: document.getElementById('userMenuBtn'),
            userMenu: document.getElementById('userMenu'),
            userName: document.getElementById('userName'),
            loginBtn: document.getElementById('loginBtn'),
            logoutBtn: document.getElementById('logoutBtn'),
            adminBtn: document.getElementById('adminBtn'),
            backToStore: document.getElementById('backToStore'),
            
            // Cart
            cartBtn: document.getElementById('cartBtn'),
            cartModal: document.getElementById('cartModal'),
            closeCartBtn: document.getElementById('closeCartBtn'),
            cartItems: document.getElementById('cartItems'),
            emptyCart: document.getElementById('emptyCart'),
            cartCount: document.getElementById('cartCount'),
            cartSubtotal: document.getElementById('cartSubtotal'),
            cartShipping: document.getElementById('cartShipping'),
            cartTotal: document.getElementById('cartTotal'),
            checkoutBtn: document.getElementById('checkoutBtn'),
            continueShopping: document.getElementById('continueShopping'),
            
            // Checkout
            checkoutModal: document.getElementById('checkoutModal'),
            closeCheckoutBtn: document.getElementById('closeCheckoutBtn'),
            checkoutForm: document.getElementById('checkoutForm'),
            checkoutItems: document.getElementById('checkoutItems'),
            checkoutSubtotal: document.getElementById('checkoutSubtotal'),
            checkoutShipping: document.getElementById('checkoutShipping'),
            checkoutTotal: document.getElementById('checkoutTotal'),
            
            // Products
            productsGrid: document.getElementById('productsGrid'),
            productSearch: document.getElementById('productSearch'),
            sortProducts: document.getElementById('sortProducts'),
            categoryBtns: document.querySelectorAll('.category-btn'),
            loadMore: document.getElementById('loadMore'),
            
            // Product management
            productModal: document.getElementById('productModal'),
            closeProductModalBtn: document.getElementById('closeProductModalBtn'),
            productForm: document.getElementById('productForm'),
            productModalTitle: document.getElementById('productModalTitle'),
            cancelProductBtn: document.getElementById('cancelProductBtn'),
            saveProductBtn: document.getElementById('saveProductBtn'),
            
            // Admin sections
            adminSections: {
                dashboard: document.getElementById('dashboardSection'),
                orders: document.getElementById('ordersSection'),
                products: document.getElementById('productsSection'),
                customers: document.getElementById('customersSection'),
                analytics: document.getElementById('analyticsSection')
            },
            sidebarBtns: document.querySelectorAll('.sidebar-btn'),
            
            // Admin elements
            addProductBtn: document.getElementById('addProductBtn'),
            pendingOrdersBadge: document.getElementById('pendingOrdersBadge'),
            ordersTableBody: document.getElementById('ordersTableBody'),
            productsTableBody: document.getElementById('productsTableBody'),
            customersTableBody: document.getElementById('customersTableBody'),
            orderSearch: document.getElementById('orderSearch'),
            orderFilter: document.getElementById('orderFilter'),
            exportOrdersBtn: document.getElementById('exportOrdersBtn'),
            customerSearch: document.getElementById('customerSearch'),
            totalProducts: document.getElementById('totalProducts'),
            outOfStock: document.getElementById('outOfStock'),
            lowStock: document.getElementById('lowStock'),
            
            // Loading
            loadingOverlay: document.getElementById('loadingOverlay'),
            
            // Mobile menu
            mobileMenuBtn: document.getElementById('mobileMenuBtn'),
            mobileMenu: document.getElementById('mobileMenu')
        };

        // Initialize the application
        async function initApp() {
            showLoading();
            
            // Check for existing session
            const { data: { session } } = await supabase.auth.getSession();
            if (session) {
                await handleUserLogin(session.user);
            }
            
            // Load initial data
            await loadProducts();
            updateCartCount();
            setupEventListeners();
            
            hideLoading();
        }

        // Setup all event listeners
        function setupEventListeners() {
            // Auth events
            elements.userMenuBtn.addEventListener('click', toggleUserMenu);
            elements.loginBtn.addEventListener('click', () => showAuthModal('login'));
            elements.logoutBtn.addEventListener('click', handleLogout);
            elements.loginTab.addEventListener('click', () => switchAuthTab('login'));
            elements.registerTab.addEventListener('click', () => switchAuthTab('register'));
            elements.closeAuthBtn.addEventListener('click', hideAuthModal);
            elements.googleLoginBtn.addEventListener('click', handleGoogleLogin);
            
            // Login/register forms
            elements.loginForm.addEventListener('submit', handleEmailLogin);
            elements.registerForm.addEventListener('submit', handleEmailRegister);
            
            // Cart events
            elements.cartBtn.addEventListener('click', showCart);
            elements.closeCartBtn.addEventListener('click', hideCart);
            elements.checkoutBtn.addEventListener('click', showCheckout);
            elements.continueShopping.addEventListener('click', hideCart);
            elements.closeCheckoutBtn.addEventListener('click', hideCheckout);
            elements.checkoutForm.addEventListener('submit', handleCheckout);
            
            // Product events
            elements.productSearch.addEventListener('input', handleProductSearch);
            elements.sortProducts.addEventListener('change', handleSortChange);
            elements.loadMore.addEventListener('click', loadMoreProducts);
            elements.categoryBtns.forEach(btn => {
                btn.addEventListener('click', () => handleCategoryChange(btn.dataset.category));
            });
            
            // Admin events
            elements.adminBtn.addEventListener('click', showAdminDashboard);
            elements.backToStore.addEventListener('click', showCustomerView);
            
            // Admin sidebar
            elements.sidebarBtns.forEach(btn => {
                btn.addEventListener('click', () => switchAdminSection(btn.dataset.section));
            });
            
            // Product management
            elements.addProductBtn.addEventListener('click', () => showProductModal());
            elements.closeProductModalBtn.addEventListener('click', hideProductModal);
            elements.cancelProductBtn.addEventListener('click', hideProductModal);
            elements.productForm.addEventListener('submit', handleProductSave);
            
            // Order management
            elements.orderSearch.addEventListener('input', handleOrderSearch);
            elements.orderFilter.addEventListener('change', handleOrderFilter);
            elements.exportOrdersBtn.addEventListener('click', exportOrders);
            
            // Customer management
            elements.customerSearch.addEventListener('input', handleCustomerSearch);
            
            // Mobile menu
            elements.mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            
            // Close modals when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('#userMenu') && !e.target.closest('#userMenuBtn')) {
                    elements.userMenu.classList.add('hidden');
                }
                
                if (e.target === elements.cartModal) hideCart();
                if (e.target === elements.checkoutModal) hideCheckout();
                if (e.target === elements.authModal) hideAuthModal();
                if (e.target === elements.productModal) hideProductModal();
            });
            
            // Handle escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    hideCart();
                    hideCheckout();
                    hideAuthModal();
                    hideProductModal();
                }
            });
            
            // Listen for auth state changes
            supabase.auth.onAuthStateChange(async (event, session) => {
                if (event === 'SIGNED_IN' && session) {
                    await handleUserLogin(session.user);
                } else if (event === 'SIGNED_OUT') {
                    handleUserLogout();
                }
            });
        }

        // ====================
        // AUTHENTICATION FUNCTIONS
        // ====================

        async function handleUserLogin(user) {
            currentUser = {
                id: user.id,
                email: user.email,
                name: user.user_metadata?.full_name || user.email.split('@')[0],
                role: 'customer' // Default role, can be updated from database
            };
            
            // Check if user exists in profiles table
            const { data: profile } = await supabase
                .from('profiles')
                .select('*')
                .eq('id', user.id)
                .single();
            
            if (!profile) {
                // Create profile for new user
                await supabase
                    .from('profiles')
                    .insert([
                        {
                            id: user.id,
                            email: user.email,
                            full_name: user.user_metadata?.full_name || user.email.split('@')[0],
                            phone: user.user_metadata?.phone || '',
                            role: 'customer',
                            created_at: new Date().toISOString()
                        }
                    ]);
            } else {
                currentUser.role = profile.role || 'customer';
                currentUser.name = profile.full_name || currentUser.name;
            }
            
            updateUIForAuthState();
            showNotification('success', 'Welcome back!', `Hello ${currentUser.name}`);
        }

        function handleUserLogout() {
            currentUser = null;
            updateUIForAuthState();
            showNotification('info', 'Logged out', 'You have been successfully logged out');
            
            if (currentView === 'admin') {
                showCustomerView();
            }
        }

        function updateUIForAuthState() {
            const isLoggedIn = currentUser !== null;
            
            if (isLoggedIn) {
                elements.userName.textContent = currentUser.name;
                document.querySelectorAll('.auth-hidden').forEach(el => el.classList.add('hidden'));
                document.querySelectorAll('.user-menu-item').forEach(el => el.classList.remove('hidden'));
                
                if (currentUser.role === 'admin') {
                    elements.adminBtn.classList.remove('hidden');
                } else {
                    elements.adminBtn.classList.add('hidden');
                }
            } else {
                elements.userName.textContent = 'Account';
                document.querySelectorAll('.auth-hidden').forEach(el => el.classList.remove('hidden'));
                document.querySelectorAll('.user-menu-item').forEach(el => el.classList.add('hidden'));
                elements.adminBtn.classList.add('hidden');
            }
        }

        function toggleUserMenu() {
            elements.userMenu.classList.toggle('hidden');
        }

        function showAuthModal(mode = 'login') {
            elements.authModal.classList.remove('hidden');
            switchAuthTab(mode);
        }

        function hideAuthModal() {
            elements.authModal.classList.add('hidden');
            elements.loginForm.reset();
            elements.registerForm.reset();
        }

        function switchAuthTab(mode) {
            if (mode === 'login') {
                elements.loginTab.classList.add('active', 'text-pink-600', 'border-pink-600');
                elements.loginTab.classList.remove('text-gray-500');
                
                elements.registerTab.classList.remove('active', 'text-pink-600', 'border-pink-600');
                elements.registerTab.classList.add('text-gray-500');
                
                elements.loginForm.classList.remove('hidden');
                elements.registerForm.classList.add('hidden');
                elements.authTitle.textContent = 'Login';
            } else {
                elements.registerTab.classList.add('active', 'text-pink-600', 'border-pink-600');
                elements.registerTab.classList.remove('text-gray-500');
                
                elements.loginTab.classList.remove('active', 'text-pink-600', 'border-pink-600');
                elements.loginTab.classList.add('text-gray-500');
                
                elements.registerForm.classList.remove('hidden');
                elements.loginForm.classList.add('hidden');
                elements.authTitle.textContent = 'Register';
            }
        }

        async function handleEmailLogin(e) {
            e.preventDefault();
            showLoading();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const { data, error } = await supabase.auth.signInWithPassword({
                email,
                password
            });
            
            hideLoading();
            
            if (error) {
                showNotification('error', 'Login failed', error.message);
            } else {
                hideAuthModal();
                await handleUserLogin(data.user);
            }
        }

        async function handleEmailRegister(e) {
            e.preventDefault();
            showLoading();
            
            const name = document.getElementById('registerName').value;
            const phone = document.getElementById('registerPhone').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            const { data, error } = await supabase.auth.signUp({
                email,
                password,
                options: {
                    data: {
                        full_name: name,
                        phone: phone
                    }
                }
            });
            
            hideLoading();
            
            if (error) {
                showNotification('error', 'Registration failed', error.message);
            } else {
                showNotification('success', 'Registration successful!', 'Please check your email to confirm your account');
                hideAuthModal();
            }
        }

        async function handleGoogleLogin() {
            const { error } = await supabase.auth.signInWithOAuth({
                provider: 'google',
                options: {
                    queryParams: {
                        access_type: 'offline',
                        prompt: 'consent'
                    }
                }
            });
            
            if (error) {
                showNotification('error', 'Google login failed', error.message);
            }
        }

        async function handleLogout() {
            const { error } = await supabase.auth.signOut();
            if (error) {
                showNotification('error', 'Logout failed', error.message);
            }
        }

        // ====================
        // PRODUCT FUNCTIONS
        // ====================

        async function loadProducts(category = 'all') {
            showLoading();
            
            let query = supabase
                .from('products')
                .select('*')
                .order('created_at', { ascending: false });
            
            if (category !== 'all') {
                query = query.eq('category', category);
            }
            
            const { data, error } = await query;
            
            if (error) {
                showNotification('error', 'Failed to load products', error.message);
                products = getDefaultProducts();
            } else {
                products = data.length > 0 ? data : getDefaultProducts();
            }
            
            productsLoaded = 8;
            renderProducts(products.slice(0, productsLoaded));
            
            // Update active category button
            elements.categoryBtns.forEach(btn => {
                if (btn.dataset.category === category) {
                    btn.classList.add('active-category', 'border-pink-300');
                } else {
                    btn.classList.remove('active-category', 'border-pink-300');
                }
            });
            
            hideLoading();
        }

        function getDefaultProducts() {
            return [
                { id: 1, name: 'Chocolate Fudge Cake', category: 'birthday', price: 450, stock: 15, description: 'Rich chocolate cake with fudge frosting and chocolate shavings.', image: '', rating: 4.8, sales: 128 },
                { id: 2, name: 'Vanilla Bean Dream Cake', category: 'birthday', price: 420, stock: 8, description: 'Classic vanilla cake with real vanilla bean frosting.', image: '', rating: 4.6, sales: 95 },
                { id: 3, name: 'Red Velvet Special', category: 'birthday', price: 480, stock: 12, description: 'Moist red velvet cake with cream cheese frosting.', image: '', rating: 4.9, sales: 156 },
                { id: 4, name: 'Premium Wedding Cake', category: 'wedding', price: 2999, stock: 5, description: 'Three-tier wedding cake with floral accents.', image: '', rating: 4.9, sales: 32 },
                { id: 5, name: 'Rose Gold Wedding Cake', category: 'wedding', price: 3499, stock: 3, description: 'Modern wedding cake with rose gold accents.', image: '', rating: 4.7, sales: 28 },
                { id: 6, name: 'Chocolate Cupcakes (6 pcs)', category: 'cupcakes', price: 250, stock: 25, description: 'Moist chocolate cupcakes with buttercream frosting.', image: '', rating: 4.5, sales: 210 },
                { id: 7, name: 'Vanilla Cupcakes (6 pcs)', category: 'cupcakes', price: 230, stock: 30, description: 'Classic vanilla cupcakes with vanilla frosting.', image: '', rating: 4.4, sales: 195 },
                { id: 8, name: 'Carrot Cake', category: 'desserts', price: 380, stock: 18, description: 'Moist carrot cake with cream cheese frosting and walnuts.', image: '', rating: 4.7, sales: 87 },
                { id: 9, name: 'Lemon Drizzle Cake', category: 'desserts', price: 360, stock: 10, description: 'Tangy lemon cake with lemon glaze.', image: '', rating: 4.6, sales: 72 },
                { id: 10, name: 'Custom Photo Cake', category: 'custom', price: 600, stock: 0, description: 'Custom cake with edible printed photo.', image: '', rating: 4.8, sales: 45 },
                { id: 11, name: 'Strawberry Shortcake', category: 'desserts', price: 410, stock: 7, description: 'Light sponge cake with fresh strawberries and cream.', image: '', rating: 4.5, sales: 63 },
                { id: 12, name: 'Rainbow Sprinkle Cupcakes', category: 'cupcakes', price: 265, stock: 22, description: 'Fun vanilla cupcakes with rainbow sprinkles.', image: '', rating: 4.3, sales: 178 }
            ];
        }

        function renderProducts(productsToRender) {
            if (productsToRender.length === 0) {
                elements.productsGrid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-birthday-cake text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">No cakes found</p>
                        <p class="text-gray-400">Try a different category or search term</p>
                    </div>
                `;
                return;
            }
            
            elements.productsGrid.innerHTML = productsToRender.map(product => `
                <div class="bg-white rounded-xl card-shadow overflow-hidden card-hover transition duration-300">
                    <div class="relative h-48 bg-gradient-to-br from-pink-50 to-purple-100 flex items-center justify-center">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" class="h-full w-full object-cover">` : 
                            `<i class="fas fa-birthday-cake text-5xl text-pink-400"></i>`
                        }
                        ${product.stock === 0 ? 
                            `<span class="absolute top-3 right-3 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full">Out of Stock</span>` : 
                            product.stock < 5 ? 
                            `<span class="absolute top-3 right-3 bg-amber-500 text-white text-xs font-bold px-3 py-1 rounded-full">Low Stock</span>` :
                            `<span class="absolute top-3 right-3 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full">In Stock</span>`
                        }
                    </div>
                    <div class="p-5">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-lg text-gray-800 truncate">${product.name}</h3>
                            <span class="text-pink-600 font-bold"><span class="text-rupee">â‚¹</span>${product.price}</span>
                        </div>
                        <p class="text-gray-600 text-sm mb-4 line-clamp-2">${product.description}</p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-star text-yellow-400 mr-1"></i>
                                <span class="text-gray-700 font-medium">${product.rating || 4.5}</span>
                                <span class="text-gray-500 text-sm ml-2">(${product.sales || 0} sold)</span>
                            </div>
                            <button class="add-to-cart-btn ${product.stock === 0 ? 'opacity-50 cursor-not-allowed' : ''} bg-pink-100 text-pink-600 hover:bg-pink-200 px-4 py-2 rounded-lg font-medium transition duration-300" data-id="${product.id}" ${product.stock === 0 ? 'disabled' : ''}>
                                <i class="fas fa-cart-plus mr-2"></i> Add
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Add event listeners to add to cart buttons
            document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (!btn.disabled) {
                        addToCart(parseInt(btn.dataset.id));
                    }
                });
            });
        }

        function loadMoreProducts() {
            const currentCategory = document.querySelector('.category-btn.active-category').dataset.category;
            let filteredProducts = currentCategory === 'all' ? products : products.filter(p => p.category === currentCategory);
            
            if (productsLoaded >= filteredProducts.length) {
                showNotification('info', 'No more products', 'You have reached the end of the product list');
                return;
            }
            
            const nextProducts = filteredProducts.slice(productsLoaded, productsLoaded + 4);
            productsLoaded += nextProducts.length;
            
            nextProducts.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'bg-white rounded-xl card-shadow overflow-hidden card-hover transition duration-300';
                productElement.innerHTML = `
                    <div class="relative h-48 bg-gradient-to-br from-pink-50 to-purple-100 flex items-center justify-center">
                        ${product.image ? 
                            `<img src="${product.image}" alt="${product.name}" class="h-full w-full object-cover">` : 
                            `<i class="fas fa-birthday-cake text-5xl text-pink-400"></i>`
                        }
                        ${product.stock === 0 ? 
                            `<span class="absolute top-3 right-3 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full">Out of Stock</span>` : 
                            product.stock < 5 ? 
                            `<span class="absolute top-3 right-3 bg-amber-500 text-white text-xs font-bold px-3 py-1 rounded-full">Low Stock</span>` :
                            `<span class="absolute top-3 right-3 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full">In Stock</span>`
                        }
                    </div>
                    <div class="p-5">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-lg text-gray-800 truncate">${product.name}</h3>
                            <span class="text-pink-600 font-bold"><span class="text-rupee">â‚¹</span>${product.price}</span>
                        </div>
                        <p class="text-gray-600 text-sm mb-4 line-clamp-2">${product.description}</p>
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-star text-yellow-400 mr-1"></i>
                                <span class="text-gray-700 font-medium">${product.rating || 4.5}</span>
                                <span class="text-gray-500 text-sm ml-2">(${product.sales || 0} sold)</span>
                            </div>
                            <button class="add-to-cart-btn ${product.stock === 0 ? 'opacity-50 cursor-not-allowed' : ''} bg-pink-100 text-pink-600 hover:bg-pink-200 px-4 py-2 rounded-lg font-medium transition duration-300" data-id="${product.id}" ${product.stock === 0 ? 'disabled' : ''}>
                                <i class="fas fa-cart-plus mr-2"></i> Add
                            </button>
                        </div>
                    </div>
                `;
                elements.productsGrid.appendChild(productElement);
                
                productElement.querySelector('.add-to-cart-btn').addEventListener('click', function() {
                    if (!this.disabled) {
                        addToCart(parseInt(this.dataset.id));
                    }
                });
            });
            
            if (productsLoaded >= filteredProducts.length) {
                elements.loadMore.textContent = 'No More Cakes';
                elements.loadMore.disabled = true;
                elements.loadMore.classList.add('opacity-50');
            }
        }

        function handleCategoryChange(category) {
            productsLoaded = 8;
            loadProducts(category);
        }

        function handleProductSearch() {
            const searchTerm = elements.productSearch.value.toLowerCase();
            const currentCategory = document.querySelector('.category-btn.active-category').dataset.category;
            let filteredProducts = currentCategory === 'all' ? products : products.filter(p => p.category === currentCategory);
            
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(p => 
                    p.name.toLowerCase().includes(searchTerm) || 
                    p.description.toLowerCase().includes(searchTerm)
                );
            }
            
            productsLoaded = Math.min(8, filteredProducts.length);
            renderProducts(filteredProducts.slice(0, productsLoaded));
            
            elements.loadMore.disabled = productsLoaded >= filteredProducts.length;
            elements.loadMore.classList.toggle('opacity-50', productsLoaded >= filteredProducts.length);
        }

        function handleSortChange() {
            const sortBy = elements.sortProducts.value;
            const currentCategory = document.querySelector('.category-btn.active-category').dataset.category;
            let filteredProducts = currentCategory === 'all' ? products : products.filter(p => p.category === currentCategory);
            
            switch (sortBy) {
                case 'price-low':
                    filteredProducts.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high':
                    filteredProducts.sort((a, b) => b.price - a.price);
                    break;
                case 'popular':
                    filteredProducts.sort((a, b) => (b.sales || 0) - (a.sales || 0));
                    break;
                default: // name
                    filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
            }
            
            productsLoaded = 8;
            renderProducts(filteredProducts.slice(0, productsLoaded));
        }

        // ====================
        // CART FUNCTIONS
        // ====================

        function addToCart(productId, quantity = 1) {
            if (!currentUser) {
                showNotification('info', 'Login Required', 'Please login to add items to cart');
                showAuthModal('login');
                return;
            }
            
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            if (product.stock === 0) {
                showNotification('error', 'Out of Stock', 'This product is currently out of stock');
                return;
            }
            
            if (quantity > product.stock) {
                showNotification('error', 'Insufficient Stock', `Only ${product.stock} items available`);
                return;
            }
            
            const existingItemIndex = cart.findIndex(item => item.productId === productId);
            
            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity += quantity;
            } else {
                cart.push({
                    productId,
                    productName: product.name,
                    productPrice: product.price,
                    productImage: product.image,
                    quantity
                });
            }
            
            localStorage.setItem('sweetdreams_cart', JSON.stringify(cart));
            updateCartCount();
            
            if (elements.cartModal.classList.contains('hidden')) {
                showNotification('success', 'Added to Cart', `${product.name} added to your cart`);
            } else {
                updateCartModal();
            }
        }

        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            elements.cartCount.textContent = totalItems;
        }

        function showCart() {
            updateCartModal();
            elements.cartModal.classList.remove('hidden');
        }

        function hideCart() {
            elements.cartModal.classList.add('hidden');
        }

        function updateCartModal() {
            if (cart.length === 0) {
                elements.emptyCart.classList.remove('hidden');
                elements.cartItems.innerHTML = '';
                elements.cartSubtotal.textContent = '<span class="text-rupee">â‚¹</span>0';
                elements.cartShipping.textContent = '<span class="text-rupee">â‚¹</span>0';
                elements.cartTotal.textContent = '<span class="text-rupee">â‚¹</span>0';
                elements.checkoutBtn.disabled = true;
                elements.checkoutBtn.classList.add('opacity-50');
                return;
            }
            
            elements.emptyCart.classList.add('hidden');
            
            let subtotal = 0;
            elements.cartItems.innerHTML = cart.map(item => {
                const itemTotal = item.productPrice * item.quantity;
                subtotal += itemTotal;
                
                return `
                    <div class="cart-item-enter flex items-center border-b border-gray-100 pb-4 mb-4">
                        <div class="w-16 h-16 bg-gradient-to-br from-pink-50 to-purple-100 rounded-lg flex items-center justify-center mr-4">
                            ${item.productImage ? 
                                `<img src="${item.productImage}" alt="${item.productName}" class="h-full w-full object-cover rounded-lg">` : 
                                `<i class="fas fa-birthday-cake text-pink-400"></i>`
                            }
                        </div>
                        <div class="flex-grow">
                            <h4 class="font-bold text-gray-800">${item.productName}</h4>
                            <p class="text-gray-600 text-sm"><span class="text-rupee">â‚¹</span>${item.productPrice} each</p>
                        </div>
                        <div class="flex items-center">
                            <button class="decrease-qty w-8 h-8 flex items-center justify-center border border-gray-300 rounded-l-lg" data-id="${item.productId}">
                                <i class="fas fa-minus text-gray-600"></i>
                            </button>
                            <input type="number" min="1" value="${item.quantity}" class="cart-qty w-12 h-8 border-t border-b border-gray-300 text-center" data-id="${item.productId}">
                            <button class="increase-qty w-8 h-8 flex items-center justify-center border border-gray-300 rounded-r-lg" data-id="${item.productId}">
                                <i class="fas fa-plus text-gray-600"></i>
                            </button>
                            <button class="remove-item ml-4 text-red-500 hover:text-red-700" data-id="${item.productId}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="ml-6 text-right">
                            <div class="font-bold text-gray-800"><span class="text-rupee">â‚¹</span>${itemTotal}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            const shipping = subtotal > 1000 ? 0 : 50; // Free delivery for orders above â‚¹1000
            const total = subtotal + shipping;
            
            elements.cartSubtotal.innerHTML = `<span class="text-rupee">â‚¹</span>${subtotal}`;
            elements.cartShipping.innerHTML = `<span class="text-rupee">â‚¹</span>${shipping}`;
            elements.cartTotal.innerHTML = `<span class="text-rupee">â‚¹</span>${total}`;
            
            elements.checkoutBtn.disabled = false;
            elements.checkoutBtn.classList.remove('opacity-50');
            
            // Add event listeners to cart controls
            document.querySelectorAll('.decrease-qty').forEach(btn => {
                btn.addEventListener('click', () => {
                    const productId = parseInt(btn.dataset.id);
                    const item = cart.find(item => item.productId === productId);
                    if (item && item.quantity > 1) {
                        item.quantity--;
                        localStorage.setItem('sweetdreams_cart', JSON.stringify(cart));
                        updateCartModal();
                        updateCartCount();
                    }
                });
            });
            
            document.querySelectorAll('.increase-qty').forEach(btn => {
                btn.addEventListener('click', () => {
                    const productId = parseInt(btn.dataset.id);
                    const item = cart.find(item => item.productId === productId);
                    if (item) {
                        const product = products.find(p => p.id === productId);
                        if (product && item.quantity < product.stock) {
                            item.quantity++;
                            localStorage.setItem('sweetdreams_cart', JSON.stringify(cart));
                            updateCartModal();
                            updateCartCount();
                        } else {
                            showNotification('error', 'Stock Limit', 'Cannot add more than available stock');
                        }
                    }
                });
            });
            
            document.querySelectorAll('.cart-qty').forEach(input => {
                input.addEventListener('change', (e) => {
                    const productId = parseInt(e.target.dataset.id);
                    const item = cart.find(item => item.productId === productId);
                    const product = products.find(p => p.id === productId);
                    const newQty = parseInt(e.target.value) || 1;
                    
                    if (newQty < 1) {
                        e.target.value = 1;
                        item.quantity = 1;
                    } else if (product && newQty > product.stock) {
                        e.target.value = product.stock;
                        item.quantity = product.stock;
                        showNotification('error', 'Stock Limit', 'Cannot add more than available stock');
                    } else {
                        item.quantity = newQty;
                    }
                    
                    localStorage.setItem('sweetdreams_cart', JSON.stringify(cart));
                    updateCartModal();
                    updateCartCount();
                });
            });
            
            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.addEventListener('click', () => {
                    const productId = parseInt(btn.dataset.id);
                    cart = cart.filter(item => item.productId !== productId);
                    localStorage.setItem('sweetdreams_cart', JSON.stringify(cart));
                    updateCartModal();
                    updateCartCount();
                    showNotification('info', 'Removed', 'Item removed from cart');
                });
            });
        }

        function showCheckout() {
            if (!currentUser) {
                showNotification('info', 'Login Required', 'Please login to proceed to checkout');
                showAuthModal('login');
                return;
            }
            
            if (cart.length === 0) {
                showNotification('error', 'Empty Cart', 'Your cart is empty');
                return;
            }
            
            updateCheckoutModal();
            elements.checkoutModal.classList.remove('hidden');
            hideCart();
        }

        function hideCheckout() {
            elements.checkoutModal.classList.add('hidden');
        }

        function updateCheckoutModal() {
            let subtotal = 0;
            
            elements.checkoutItems.innerHTML = cart.map(item => {
                const itemTotal = item.productPrice * item.quantity;
                subtotal += itemTotal;
                
                return `
                    <div class="flex justify-between items-center mb-3">
                        <div>
                            <div class="font-medium">${item.productName} x ${item.quantity}</div>
                            <div class="text-gray-500 text-sm"><span class="text-rupee">â‚¹</span>${item.productPrice} each</div>
                        </div>
                        <div class="font-bold"><span class="text-rupee">â‚¹</span>${itemTotal}</div>
                    </div>
                `;
            }).join('');
            
            const shipping = subtotal > 1000 ? 0 : 50;
            const total = subtotal + shipping;
            
            elements.checkoutSubtotal.innerHTML = `<span class="text-rupee">â‚¹</span>${subtotal}`;
            elements.checkoutShipping.innerHTML = `<span class="text-rupee">â‚¹</span>${shipping}`;
            elements.checkoutTotal.innerHTML = `<span class="text-rupee">â‚¹</span>${total}`;
        }

        async function handleCheckout(e) {
            e.preventDefault();
            showLoading();
            
            if (!currentUser) {
                hideLoading();
                showNotification('error', 'Not Logged In', 'Please login to place an order');
                return;
            }
            
            if (cart.length === 0) {
                hideLoading();
                showNotification('error', 'Empty Cart', 'Your cart is empty');
                return;
            }
            
            // Check stock availability
            for (const item of cart) {
                const product = products.find(p => p.id === item.productId);
                if (!product || item.quantity > product.stock) {
                    hideLoading();
                    showNotification('error', 'Stock Issue', `${item.productName} is out of stock or insufficient quantity`);
                    return;
                }
            }
            
            // Calculate totals
            const subtotal = cart.reduce((sum, item) => sum + (item.productPrice * item.quantity), 0);
            const shipping = subtotal > 1000 ? 0 : 50;
            const total = subtotal + shipping;
            
            try {
                // Create order in Supabase
                const { data: order, error: orderError } = await supabase
                    .from('orders')
                    .insert([
                        {
                            customer_id: currentUser.id,
                            customer_name: currentUser.name,
                            customer_email: currentUser.email,
                            items: cart,
                            subtotal: subtotal,
                            shipping: shipping,
                            total: total,
                            status: 'pending',
                            payment_method: document.querySelector('input[name="payment"]:checked').value,
                            shipping_address: e.target.querySelector('textarea').value,
                            phone: e.target.querySelector('input[type="tel"]').value
                        }
                    ])
                    .select()
                    .single();
                
                if (orderError) throw orderError;
                
                // Update product stock in Supabase
                for (const item of cart) {
                    const product = products.find(p => p.id === item.productId);
                    const newStock = product.stock - item.quantity;
                    
                    await supabase
                        .from('products')
                        .update({ stock: newStock })
                        .eq('id', item.productId);
                }
                
                // Clear cart
                cart = [];
                localStorage.removeItem('sweetdreams_cart');
                
                hideLoading();
                hideCheckout();
                updateCartCount();
                
                showNotification('success', 'Order Placed!', `Order #${order.id} has been placed successfully. Total: <span class="text-rupee">â‚¹</span>${total}`);
                
                // Reload products to update stock
                await loadProducts();
                
            } catch (error) {
                hideLoading();
                showNotification('error', 'Order Failed', error.message);
            }
        }

        // ====================
        // ADMIN FUNCTIONS
        // ====================

        async function showAdminDashboard() {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('error', 'Access Denied', 'Admin privileges required');
                return;
            }
            
            currentView = 'admin';
            elements.customerView.classList.add('hidden');
            elements.adminView.classList.remove('hidden');
            
            await loadAdminDashboard();
            switchAdminSection('dashboard');
        }

        function showCustomerView() {
            currentView = 'customer';
            elements.adminView.classList.add('hidden');
            elements.customerView.classList.remove('hidden');
        }

        function switchAdminSection(section) {
            // Hide all sections
            Object.values(elements.adminSections).forEach(sec => {
                sec.classList.add('hidden');
            });
            
            // Show selected section
            if (elements.adminSections[section]) {
                elements.adminSections[section].classList.remove('hidden');
            }
            
            // Update active sidebar button
            elements.sidebarBtns.forEach(btn => {
                if (btn.dataset.section === section) {
                    btn.classList.add('sidebar-item', 'active');
                } else {
                    btn.classList.remove('sidebar-item', 'active');
                }
            });
            
            // Load section data
            switch (section) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'products':
                    loadAdminProducts();
                    break;
                case 'customers':
                    loadCustomers();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
            }
        }

        async function loadAdminDashboard() {
            showLoading();
            
            try {
                // Get pending orders count
                const { count: pendingOrders } = await supabase
                    .from('orders')
                    .select('*', { count: 'exact', head: true })
                    .eq('status', 'pending');
                
                elements.pendingOrdersBadge.textContent = pendingOrders || 0;
                
                // Get recent orders
                const { data: recentOrders } = await supabase
                    .from('orders')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(5);
                
                elements.recentOrdersList.innerHTML = (recentOrders || []).map(order => `
                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                        <div>
                            <div class="font-medium">Order #${order.id}</div>
                            <div class="text-gray-500 text-sm">${order.customer_name}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold"><span class="text-rupee">â‚¹</span>${order.total}</div>
                            <span class="order-status ${getStatusClass(order.status)}">${order.status}</span>
                        </div>
                    </div>
                `).join('');
                
                // Get top products
                const { data: topProducts } = await supabase
                    .from('products')
                    .select('*')
                    .order('sales', { ascending: false })
                    .limit(5);
                
                elements.topProductsList.innerHTML = (topProducts || []).map(product => `
                    <div class="flex justify-between items-center p-3 bg-white rounded-lg">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-gradient-to-br from-pink-50 to-purple-100 rounded-lg flex items-center justify-center mr-3">
                                <i class="fas fa-birthday-cake text-pink-400"></i>
                            </div>
                            <div>
                                <div class="font-medium truncate max-w-xs">${product.name}</div>
                                <div class="text-gray-500 text-sm">${formatCategory(product.category)}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold">${product.sales || 0} sold</div>
                            <div class="text-gray-500 text-sm"><span class="text-rupee">â‚¹</span>${product.price}</div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                showNotification('error', 'Failed to load dashboard', error.message);
            }
            
            hideLoading();
        }

        async function loadDashboard() {
            await loadAdminDashboard();
            
            // Update stats
            const { count: totalProducts } = await supabase
                .from('products')
                .select('*', { count: 'exact', head: true });
            
            const { count: outOfStock } = await supabase
                .from('products')
                .select('*', { count: 'exact', head: true })
                .eq('stock', 0);
            
            const { count: lowStock } = await supabase
                .from('products')
                .select('*', { count: 'exact', head: true })
                .lt('stock', 10)
                .gt('stock', 0);
            
            elements.totalProducts.textContent = totalProducts || 0;
            elements.outOfStock.textContent = outOfStock || 0;
            elements.lowStock.textContent = lowStock || 0;
        }

        async function loadOrders() {
            showLoading();
            
            try {
                const { data: orders } = await supabase
                    .from('orders')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                renderOrdersTable(orders || []);
            } catch (error) {
                showNotification('error', 'Failed to load orders', error.message);
            }
            
            hideLoading();
        }

        function renderOrdersTable(orders) {
            elements.ordersTableBody.innerHTML = orders.map(order => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4 font-medium">#${order.id}</td>
                    <td class="py-3 px-4">${order.customer_name}</td>
                    <td class="py-3 px-4">${new Date(order.created_at).toLocaleDateString()}</td>
                    <td class="py-3 px-4 font-bold"><span class="text-rupee">â‚¹</span>${order.total}</td>
                    <td class="py-3 px-4">
                        <span class="order-status ${getStatusClass(order.status)}">${order.status}</span>
                    </td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button class="view-order-btn p-2 text-blue-600 hover:bg-blue-50 rounded-lg" data-id="${order.id}">
                                <i class="fas fa-eye"></i>
                            </button>
                            <select class="update-order-status border border-gray-300 rounded-lg px-3 py-1 text-sm" data-id="${order.id}">
                                <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                                <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
                                <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                                <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                            </select>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            // Add event listeners
            document.querySelectorAll('.view-order-btn').forEach(btn => {
                btn.addEventListener('click', () => viewOrderDetails(parseInt(btn.dataset.id)));
            });
            
            document.querySelectorAll('.update-order-status').forEach(select => {
                select.addEventListener('change', (e) => {
                    updateOrderStatus(parseInt(e.target.dataset.id), e.target.value);
                });
            });
        }

        async function viewOrderDetails(orderId) {
            showLoading();
            
            try {
                const { data: order } = await supabase
                    .from('orders')
                    .select('*')
                    .eq('id', orderId)
                    .single();
                
                if (order) {
                    const orderDetailsHTML = `
                        <div class="bg-white rounded-xl shadow-lg p-6 max-w-2xl">
                            <h3 class="text-2xl font-bold text-gray-800 mb-6">Order #${order.id} Details</h3>
                            
                            <div class="grid grid-cols-2 gap-6 mb-6">
                                <div>
                                    <h4 class="font-bold text-gray-700 mb-2">Customer Information</h4>
                                    <p class="text-gray-600"><strong>Name:</strong> ${order.customer_name}</p>
                                    <p class="text-gray-600"><strong>Email:</strong> ${order.customer_email}</p>
                                    <p class="text-gray-600"><strong>Phone:</strong> ${order.phone}</p>
                                    <p class="text-gray-600"><strong>Date:</strong> ${new Date(order.created_at).toLocaleString()}</p>
                                    <p class="text-gray-600"><strong>Status:</strong> <span class="order-status ${getStatusClass(order.status)}">${order.status}</span></p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-700 mb-2">Order Summary</h4>
                                    <p class="text-gray-600"><strong>Subtotal:</strong> <span class="text-rupee">â‚¹</span>${order.subtotal}</p>
                                    <p class="text-gray-600"><strong>Shipping:</strong> <span class="text-rupee">â‚¹</span>${order.shipping}</p>
                                    <p class="text-gray-600"><strong>Total:</strong> <span class="text-rupee">â‚¹</span>${order.total}</p>
                                    <p class="text-gray-600"><strong>Payment:</strong> ${order.payment_method}</p>
                                </div>
                            </div>
                            
                            <h4 class="font-bold text-gray-700 mb-3">Shipping Address</h4>
                            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                                <p class="text-gray-600">${order.shipping_address}</p>
                            </div>
                            
                            <h4 class="font-bold text-gray-700 mb-3">Order Items</h4>
                            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                                ${Array.isArray(order.items) ? order.items.map(item => `
                                    <div class="flex justify-between items-center py-2 border-b border-gray-200 last:border-0">
                                        <div>
                                            <p class="font-medium">${item.productName}</p>
                                            <p class="text-gray-500 text-sm">Quantity: ${item.quantity} | <span class="text-rupee">â‚¹</span>${item.productPrice} each</p>
                                        </div>
                                        <div class="font-bold">
                                            <span class="text-rupee">â‚¹</span>${item.productPrice * item.quantity}
                                        </div>
                                    </div>
                                `).join('') : '<p class="text-gray-500">No items found</p>'}
                            </div>
                            
                            <div class="flex justify-end">
                                <button onclick="Swal.close()" class="border border-gray-300 text-gray-700 font-medium px-6 py-2 rounded-lg hover:bg-gray-50 transition duration-300">
                                    Close
                                </button>
                            </div>
                        </div>
                    `;
                    
                    Swal.fire({
                        html: orderDetailsHTML,
                        showConfirmButton: false,
                        width: '800px'
                    });
                }
            } catch (error) {
                showNotification('error', 'Failed to load order details', error.message);
            }
            
            hideLoading();
        }

        async function updateOrderStatus(orderId, newStatus) {
            showLoading();
            
            try {
                const { error } = await supabase
                    .from('orders')
                    .update({ status: newStatus })
                    .eq('id', orderId);
                
                if (error) throw error;
                
                showNotification('success', 'Order Updated', `Order #${orderId} status updated to ${newStatus}`);
                await loadOrders();
                await loadAdminDashboard();
            } catch (error) {
                showNotification('error', 'Update Failed', error.message);
            }
            
            hideLoading();
        }

        function handleOrderSearch() {
            const searchTerm = elements.orderSearch.value.toLowerCase();
            const statusFilter = elements.orderFilter.value;
            
            // This would be implemented with actual Supabase queries
            showNotification('info', 'Search Feature', 'Order search would be implemented with backend filtering');
        }

        function handleOrderFilter() {
            handleOrderSearch(); // Reuse the same logic
        }

        function exportOrders() {
            showNotification('info', 'Export Feature', 'Order export would generate a CSV file from Supabase data');
        }

        async function loadAdminProducts() {
            showLoading();
            
            try {
                const { data: adminProducts } = await supabase
                    .from('products')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                renderProductsTable(adminProducts || []);
            } catch (error) {
                showNotification('error', 'Failed to load products', error.message);
            }
            
            hideLoading();
        }

        function renderProductsTable(adminProducts) {
            elements.productsTableBody.innerHTML = adminProducts.map(product => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-gradient-to-br from-pink-50 to-purple-100 rounded-lg flex items-center justify-center mr-3">
                                ${product.image ? 
                                    `<img src="${product.image}" alt="${product.name}" class="h-full w-full object-cover rounded-lg">` : 
                                    `<i class="fas fa-birthday-cake text-pink-400"></i>`
                                }
                            </div>
                            <div>
                                <div class="font-medium">${product.name}</div>
                                <div class="text-gray-500 text-sm truncate max-w-xs">${product.description}</div>
                            </div>
                        </div>
                    </td>
                    <td class="py-3 px-4">
                        <span class="bg-pink-100 text-pink-800 px-3 py-1 rounded-full text-sm">${formatCategory(product.category)}</span>
                    </td>
                    <td class="py-3 px-4 font-bold"><span class="text-rupee">â‚¹</span>${product.price}</td>
                    <td class="py-3 px-4">
                        <span class="${product.stock === 0 ? 'text-red-600' : product.stock < 10 ? 'text-amber-600' : 'text-green-600'} font-bold">
                            ${product.stock}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <span class="order-status ${getStatusClass(product.stock)}">
                            ${product.stock === 0 ? 'Out of Stock' : product.stock < 10 ? 'Low Stock' : 'In Stock'}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button class="edit-product-btn p-2 text-blue-600 hover:bg-blue-50 rounded-lg" data-id="${product.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="delete-product-btn p-2 text-red-600 hover:bg-red-50 rounded-lg" data-id="${product.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            // Add event listeners
            document.querySelectorAll('.edit-product-btn').forEach(btn => {
                btn.addEventListener('click', () => showProductModal(parseInt(btn.dataset.id)));
            });
            
            document.querySelectorAll('.delete-product-btn').forEach(btn => {
                btn.addEventListener('click', () => deleteProduct(parseInt(btn.dataset.id)));
            });
            
            // Update product stats
            elements.totalProducts.textContent = adminProducts.length;
            elements.outOfStock.textContent = adminProducts.filter(p => p.stock === 0).length;
            elements.lowStock.textContent = adminProducts.filter(p => p.stock > 0 && p.stock < 10).length;
        }

        function showProductModal(productId = null) {
            editingProductId = productId;
            
            if (productId) {
                // Edit existing product
                const product = products.find(p => p.id === productId);
                if (!product) return;
                
                elements.productModalTitle.textContent = 'Edit Product';
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productStock').value = product.stock;
                document.getElementById('productDescription').value = product.description;
                document.getElementById('productImage').value = product.image || '';
            } else {
                // Add new product
                elements.productModalTitle.textContent = 'Add New Product';
                elements.productForm.reset();
            }
            
            elements.productModal.classList.remove('hidden');
        }

        function hideProductModal() {
            elements.productModal.classList.add('hidden');
            editingProductId = null;
        }

        async function handleProductSave(e) {
            e.preventDefault();
            showLoading();
            
            const productData = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseInt(document.getElementById('productPrice').value),
                stock: parseInt(document.getElementById('productStock').value),
                description: document.getElementById('productDescription').value,
                image: document.getElementById('productImage').value || ''
            };
            
            try {
                if (editingProductId) {
                    // Update existing product
                    const { error } = await supabase
                        .from('products')
                        .update(productData)
                        .eq('id', editingProductId);
                    
                    if (error) throw error;
                    showNotification('success', 'Product Updated', `${productData.name} has been updated`);
                } else {
                    // Add new product
                    const { error } = await supabase
                        .from('products')
                        .insert([productData]);
                    
                    if (error) throw error;
                    showNotification('success', 'Product Added', `${productData.name} has been added to the catalog`);
                }
                
                hideProductModal();
                await loadAdminProducts();
                await loadProducts(); // Refresh customer view
                
            } catch (error) {
                showNotification('error', 'Save Failed', error.message);
            }
            
            hideLoading();
        }

        async function deleteProduct(productId) {
            Swal.fire({
                title: 'Delete Product',
                text: 'Are you sure you want to delete this product? This action cannot be undone.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Yes, delete it!'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    try {
                        const { error } = await supabase
                            .from('products')
                            .delete()
                            .eq('id', productId);
                        
                        if (error) throw error;
                        
                        showNotification('success', 'Product Deleted', 'Product has been deleted');
                        await loadAdminProducts();
                        await loadProducts(); // Refresh customer view
                    } catch (error) {
                        showNotification('error', 'Delete Failed', error.message);
                    }
                    
                    hideLoading();
                }
            });
        }

        async function loadCustomers() {
            showLoading();
            
            try {
                const { data: profiles } = await supabase
                    .from('profiles')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                renderCustomersTable(profiles || []);
            } catch (error) {
                showNotification('error', 'Failed to load customers', error.message);
            }
            
            hideLoading();
        }

        function renderCustomersTable(customers) {
            elements.customersTableBody.innerHTML = customers.map(user => `
                <tr class="border-b border-gray-100 hover:bg-gray-50">
                    <td class="py-3 px-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 rounded-full bg-pink-gradient flex items-center justify-center text-white font-bold mr-3">
                                ${(user.full_name || user.email).charAt(0).toUpperCase()}
                            </div>
                            <div>
                                <div class="font-medium">${user.full_name || 'No Name'}</div>
                                <div class="text-gray-500 text-sm">${new Date(user.created_at).toLocaleDateString()}</div>
                            </div>
                        </div>
                    </td>
                    <td class="py-3 px-4">${user.email}</td>
                    <td class="py-3 px-4 font-bold">${user.orders_count || 0}</td>
                    <td class="py-3 px-4 font-bold"><span class="text-rupee">â‚¹</span>${user.total_spent || 0}</td>
                    <td class="py-3 px-4">
                        <span class="order-status ${user.role === 'admin' ? 'status-processing' : 'status-delivered'}">
                            ${user.role || 'customer'}
                        </span>
                    </td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button class="make-admin-btn p-2 text-purple-600 hover:bg-purple-50 rounded-lg" data-id="${user.id}" data-role="${user.role}">
                                <i class="fas ${user.role === 'admin' ? 'fa-user' : 'fa-crown'}"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            // Add event listeners
            document.querySelectorAll('.make-admin-btn').forEach(btn => {
                btn.addEventListener('click', () => toggleUserRole(btn.dataset.id, btn.dataset.role));
            });
        }

        async function toggleUserRole(userId, currentRole) {
            const newRole = currentRole === 'admin' ? 'customer' : 'admin';
            
            Swal.fire({
                title: 'Change User Role',
                text: `Are you sure you want to make this user ${newRole === 'admin' ? 'an admin' : 'a customer'}?`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#8b5cf6',
                cancelButtonColor: '#6b7280',
                confirmButtonText: `Yes, make ${newRole}`
            }).then(async (result) => {
                if (result.isConfirmed) {
                    showLoading();
                    
                    try {
                        const { error } = await supabase
                            .from('profiles')
                            .update({ role: newRole })
                            .eq('id', userId);
                        
                        if (error) throw error;
                        
                        showNotification('success', 'Role Updated', `User is now ${newRole}`);
                        await loadCustomers();
                    } catch (error) {
                        showNotification('error', 'Update Failed', error.message);
                    }
                    
                    hideLoading();
                }
            });
        }

        function handleCustomerSearch() {
            const searchTerm = elements.customerSearch.value.toLowerCase();
            // This would be implemented with actual Supabase queries
            showNotification('info', 'Search Feature', 'Customer search would be implemented with backend filtering');
        }

        function loadAnalytics() {
            // Create revenue chart
            const revenueCtx = document.getElementById('revenueChart')?.getContext('2d');
            if (revenueCtx) {
                new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [{
                            label: 'Revenue (â‚¹)',
                            data: [125000, 142000, 138000, 189000, 210000, 198000, 225000, 240000, 218000, 235000, 248000, 265000],
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                ticks: {
                                    callback: function(value) {
                                        return 'â‚¹' + value.toLocaleString('en-IN');
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Create category chart
            const categoryCtx = document.getElementById('categoryChart')?.getContext('2d');
            if (categoryCtx) {
                new Chart(categoryCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Birthday Cakes', 'Wedding Cakes', 'Cupcakes', 'Desserts', 'Custom'],
                        datasets: [{
                            data: [35, 25, 20, 15, 5],
                            backgroundColor: [
                                '#f472b6',
                                '#8b5cf6',
                                '#fbbf24',
                                '#10b981',
                                '#6b7280'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                            }
                        }
                    }
                });
            }
            
            // Create orders chart
            const ordersCtx = document.getElementById('ordersChart')?.getContext('2d');
            if (ordersCtx) {
                new Chart(ordersCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                        datasets: [
                            {
                                label: 'Orders',
                                data: [142, 168, 155, 189, 210, 198, 225, 240, 218, 235, 248, 265],
                                backgroundColor: '#f472b6',
                                borderRadius: 6
                            },
                            {
                                label: 'Customers',
                                data: [120, 142, 138, 165, 189, 175, 195, 210, 198, 215, 225, 240],
                                backgroundColor: '#8b5cf6',
                                borderRadius: 6
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
        }

        // ====================
        // UTILITY FUNCTIONS
        // ====================

        function getStatusClass(status) {
            if (typeof status === 'number') {
                // For stock levels
                if (status === 0) return 'status-cancelled';
                if (status < 5) return 'status-pending';
                if (status < 10) return 'status-processing';
                return 'status-delivered';
            }
            
            // For order status
            switch(status) {
                case 'pending': return 'status-pending';
                case 'processing': return 'status-processing';
                case 'shipped': return 'status-shipped';
                case 'delivered': return 'status-delivered';
                case 'cancelled': return 'status-cancelled';
                default: return 'status-pending';
            }
        }

        function formatCategory(category) {
            const words = category.split('-');
            return words.map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
        }

        function showLoading() {
            elements.loadingOverlay.classList.remove('hidden');
        }

        function hideLoading() {
            elements.loadingOverlay.classList.add('hidden');
        }

        function showNotification(type, title, message) {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer);
                    toast.addEventListener('mouseleave', Swal.resumeTimer);
                }
            });
            
            Toast.fire({
                icon: type,
                title: title,
                html: message
            });
        }

        function toggleMobileMenu() {
            elements.mobileMenu.classList.toggle('hidden');
        }

        // ====================
        // SUPABASE SETUP GUIDE
        // ====================
        /*
        To set up Supabase:
        
        1. Go to https://supabase.com and create an account
        2. Create a new project
        3. Get your Project URL and anon key from Settings > API
        4. Update the SUPABASE_URL and SUPABASE_ANON_KEY at the top of this file
        
        5. Run these SQL commands in the SQL Editor:
        
        -- Create profiles table
        CREATE TABLE profiles (
            id UUID REFERENCES auth.users ON DELETE CASCADE PRIMARY KEY,
            email TEXT UNIQUE NOT NULL,
            full_name TEXT,
            phone TEXT,
            role TEXT DEFAULT 'customer',
            orders_count INTEGER DEFAULT 0,
            total_spent INTEGER DEFAULT 0,
            created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
        );
        
        -- Create products table
        CREATE TABLE products (
            id SERIAL PRIMARY KEY,
            name TEXT NOT NULL,
            category TEXT NOT NULL,
            price INTEGER NOT NULL,
            stock INTEGER DEFAULT 0,
            description TEXT,
            image TEXT,
            rating DECIMAL(2,1) DEFAULT 4.5,
            sales INTEGER DEFAULT 0,
            created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
        );
        
        -- Create orders table
        CREATE TABLE orders (
            id SERIAL PRIMARY KEY,
            customer_id UUID REFERENCES profiles(id),
            customer_name TEXT NOT NULL,
            customer_email TEXT NOT NULL,
            items JSONB NOT NULL,
            subtotal INTEGER NOT NULL,
            shipping INTEGER NOT NULL,
            total INTEGER NOT NULL,
            status TEXT DEFAULT 'pending',
            payment_method TEXT NOT NULL,
            shipping_address TEXT NOT NULL,
            phone TEXT NOT NULL,
            created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
        );
        
        6. Set up Row Level Security (RLS) policies in Supabase
        7. Enable Google OAuth in Authentication > Providers
        */

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
